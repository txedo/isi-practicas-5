\section{Iniciación a la programación de aplicaciones con JXTA}

El objetivo de esta sección es que sirva al lector como guía de referencia en su iniciación a la programación de aplicaciones basadas en JXTA. Para ello se comenzará configurando el entorno de Java y se darán unas nociones básicas de configuración del entorno de JXTA. Acto seguido, se indicará como ejecutar el \textit{shell} de JXTA y, por último, se hará un pequeño ejemplo tipo \textit{HelloWorld}.

\subsection{Requisitos del sistema}

La implementación actual de JXTA requiere que el sistema operativo tenga instalado una versión igual o posterior a la 5.0 del entorno de ejecución de Java (JRE o \textit{Run-Time Environtment}) o del entorno de desarrollo (SDK o \textit{Software Development Kit}). Tanto el JDK como el JRE están disponibles para sistemas basados en Solaris, Microsoft Windows, Linux, Mac OS X, etcétera.

\subsection{Instalación y configuración de los entornos}
\subsubsection{Java}
Para comprobar si ya dispone de una instalación del entorno de ejecución de Java en el equipo y que está configurado correctamente, abra una ventana de comandos \textit{(Inicio -\textgreater Ejecutar -\textgreater cmd)} y escriba "`java -version"'. Debe obtener un resultado similar al de la figura \ref{fig:java-version}:

\imagen{./imagenes/java-version.png}{0.80}{Cómo consultar la versión de Java instalada}{fig:java-version}

Si aparece un mensaje de error, pruebe lo siguiente: 
\begin{milista}
	\item Compruebe si tiene instalado Java. Para ello compruebe que exista el directorio Java en \textit{C:\textbackslash Archivos de programa} (típicamente). Si lo está, configúrelo como se indica más abajo.
	\item Si no existe, vaya a la siguiente dirección de Internet y descargue la última versión del  Java SE Development Kit (JDK) \cite{download-jdk}
\end{milista}

Una vez descargado, ejecute el archivo, elija el directorio de instalación y siga los pasos para completar la instalación. Tras instalarlo, debe configurarlo. Para ello vaya a \textit{Inicio} y haga clic derecho en \textit{Mi PC}. En las opciones, elija la pestaña de \textit{Opciones Avanzadas} y haga clic en \textit{Variables de entorno}. En la nueva ventana que aparece, busque la variable \textit{Path} y añada al final \texttt{;C:\textbackslash Archivos de programa\textbackslash Java\textbackslash jdk1.x.x\_xx\textbackslash bin}, donde "`x"' hace referencia a la versión que tiene instalada de Java. Ese es el directorio de instalación por defecto de Java. Si en la instalación eligió otro diferente, debe introducir el que eligió al instalarlo.

Una vez realizados los pasos descritos, pruebe a ejecutar de nuevo la sentencia "`java -versión"' en una ventana de comandos.


\subsubsection{JXTA}
Para comenzar, debe hacerse de una versión funcional de la librería de JXTA. Se proponen dos métodos (ambos requieren que visite la página de descargas de JXTA \cite{download-jxta}):
\begin{milista}
	\item Descargue el fichero \textit{jxse-src-2.5.zip}. Descomprímalo y compílelo con \textit{ant} o \textit{make}. Acto seguido se generará el fichero \textit{jxta.jar} en el directorio \textit{./jxse-src-2.5/dist/}.
	\item Descargue el fichero \textit{jxse-lib-2.5.zip}. En su interior se encuentra el fichero \textit{jxta.jar} ya compilado.
\end{milista}

También puede descargar la documentación de JXTA (fichero \textit{jxse-doc-2.5.zip}) o la guía de programación de JXTA para Java SE/EE (JXSE) 2.5 \cite{jxta-programming-guide}.

En versiones anteriores era necesario realizar una instalación de dicho motor, pero hoy en día basta con incluir la librería de JXTA en la aplicación y realizar una configuración del \textit{peer}, bien sea en el código fuente de la aplicación o mediante un \textit{configurator} gráfico externo (ver sección \ref{howto-run-jxta-apps}).

\subsection{Cómo ejecutar aplicaciones JXTA} \label{howto-run-jxta-apps}
Para ejecutar una aplicación JXTA es necesario indicar donde se encuentran las librerías, bien incluyéndolas en el \textit{classpath} del sistema operativo o añadiéndolas al proyecto, en el entorno de programación.

JXTA incluye una interfaz gráfica (ver Figura \ref{fig:jxta-configurator}) que nos permite configurar el \textit{peer}, aunque normalmente este paso se suele evitar ya que cada aplicación lo configura por código utilizando la clase \textit{NetworkConigurator} o el \textit{NetkworkManager}, que abstrae la configuración a una serie de configuraciónes predefinidas:
\begin{milista}
	\item \textbf{Ad-Hoc}: un nodo típicamente desplegado en una red ad-hoc, es decir, una red en la que no hay un nodo central y todos los dispositivos están en igualidad de condiciones. El \textit{par} no utilizará una infraestructura de \textit{pares} (servicios \textit{rendezvous} o \textit{relay}).
	\item \textbf{Edge}: este tipo de nodos se pueden unir a una infraestructura de \textit{pares} (servicios \textit{rendezvous} o \textit{relay}).
	\item \textbf{Rendezvous}: proporiona servicios auto-suficientes (descubrimiento, etc.).
	\item \textbf{Relay}: proporciona servicios de mensajería, permitiendo atravesar corta-fuegos.
	\item \textbf{Proxy}: proporciona servicios de proxy.
	\item \textbf{Super}: proporciona la funcionalidad de un nodo \textit{rendezvous}, \textit{relay} o \textit{proxy}.
\end{milista}

\imagen{./imagenes/jxta-configurator.png}{0.3}{JXTA Configurator}{fig:jxta-configurator}

Una vez que el \textit{peer} ha sido configurado por alguno de los métodos mencionados, se creará automáticamente un directorio llamado \textit{.jxta} en el directorio de la aplicación. Si se inspecciona dicho directorio, podrá encontrar un fichero llamado \textit{PlatformConfig}, que es el fichero de configuración del par. Si desea volver a configurar el \textit{par}, se recomienda que borre dicho directorio.


\subsection{Cómo utilizar el \textit{Shell} de JXTA}
Para familiarizarse con JXTA, se recomienda practicar primero con el \textit{shell} que incorpora JXTA. De este modo se puede comprender el funcionamiento del sistema antes de adentrarse en el mundo de la programación. A continuación se explicará un sencillo ejemplo de cómo descubrir los pares del grupo por defecto, pero primero debe descargarse el shell de su página Web \cite{download-shell}.

Una vez que haya descargado el shell, descomprímalo y ejecute el script \textit{run-shell.sh} (Linux/MacOS) o \textit{run-shell.bat} (Windows). Estos scripts incluyen automáticamente en su classpath la ubicación de las librerías de JXTA. Obtendrá una ventana como la que se muestra en la Figura \ref{fig:jxta-shell}. Si introduce la órden \textit{'man'} obtendrá una lista con todas las órdenes que puede ejecutar en el \textit{shell} junto a una breve descripción de cada una de ellas.

\imagen{./imagenes/jxta-shell.png}{0.3}{Shell de JXTA}{fig:jxta-shell}

\paragraph{Ejemplo práctico: Descubrimiento de pares}
A continuación se realizará un sencillo ejemplo de cómo descubrir los pares que hay en el grupo. Se propone al lector que inicie un \textit{shell} en dos ordenadores distintos, pertenecientes a una misma red, y ejecute las órdenes "`peers"' y "`peers -r"'. Para obtener más información acerca de la orden "`peers"' puede ejecutar "`man peers"'. Si observa la figura \ref{fig:jxta-shell-peers} para ver los resultados de este ejemplo.

\imagen{./imagenes/jxta-shell-peers.png}{0.4}{Ejemplo de descubrimiento de pares}{fig:jxta-shell-peers}

Se propone al lector que haga uso de las órdenes \textit{talk} y \textit{xfer} para establecer una conversación de chat entre dos pares y para transferir ficheros, respectivamente. Utilice "`man talk"' y "`man xfer"' para obtener sus respectivas ayudas.

Por último, si no consigue que funcione alguno de los ejercicios propuestos, pruebe a deshabilitar el \textit{firewall} de su equipo.


\subsection{Ejemplo de un HelloWorld}
A continuación se muestra el código Java correspondiente a un programa de tipo \textit{Hola Mundo}. En este ejemplo se hace uso del \textit{NetworkManager} para configurar el \textit{par} en código, por lo que en ningún momento se mostrará el \textit{JXTA UI Configurator}.

La sentencia \texttt{manager = new NetworkManager(ConfigMode.EDGE, "HelloWorld");} configura el \textit{par} con una configuración por defecto: nodo de tipo \textit{edge} y le asigna el nombre \textit{HelloWorld}. Se podría personalizar esta configuración obteniendo el objeto \textit{NetworkConfigurator} que encapsula el \textit{NetworkManager} con una sentencia del tipo a \texttt{NetworkConfigurator configurator = manager.getConfigurator();}.

El cometido de la aplicación es sencillo:
\begin{enumerate}
	\item Crea una instancia del \textit{NetworkManager} e inicia la red JXTA.
	\item Se pone a la escucha de conexiones durante 2 minutos.
	\item Detiene la red JXTA.
\end{enumerate}

Una vez que la ejecución de la aplicación termina, se puede comprobar el directorio de configuración que se ha creado (\textit{.jxta}):
\begin{milista}
	\item \textbf{PlatformConfig}: el fichero de configuración creado por el \textit{NetworkManager}.
	\item \textbf{cm}: es un directorio que contiene un subdirectorio para cada grupo que se ha descubierto. En este ejemplo, deberían aparecer los subdirectorios \textit{jxta-NetGroup} y \textit{jxta-WorldGroup}. Estos subdirectorios deben contener ficheros de índice (*.idx) y ficheros de anuncios (advertisements.tbl).
\end{milista}

\texttt{\lstinputlisting[inputencoding=latin1]{HelloWorld.java}}

\paragraph{Notas de interés}
\begin{enumerate}
	\item Cada vez que se instancia el NetworkManager, se crea un nuevo identificador de \textit{par} (JXTA PeerID), a menos que se haya cargado una configuración local.
	\item Si se necesita cambiar la configuración local de un \textit{par} (de EDGE a RENDEZVOUS, por ejemplo), se debe hacer mediante el NetworkManager utilizando el método \textit{setMode()} \textbf{antes} de que se inicie la red.
\end{enumerate}
